<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ilaymc Player List</title>
  <style>
    body {
      background-color: #0a0a0a;
      color: #60a5fa;
      font-family: monospace;
      text-align: center;
      padding: 40px;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 20px;
    }
    .player {
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>ilaymc Player List</h1>
  <div id="playerList">Loading...</div>

  <script>
    const apiUrl = "https://5f46-2a06-c701-cc37-b00-be54-2fff-fe0b-5126.ngrok-free.app";
    const apiToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxLCJpYXQiOjE3NDUzMDExNDYsInRva2VuX2lkIjoxfQ.7tE5MU5DNifKVxFeGQdpGF1XJPG7l1ldWbRHkF3L6Q8";
    const playerListDiv = document.getElementById('playerList');

    async function fetchPlayers() {
      try {
        const res = await fetch(apiUrl, {
          headers: {
            "Authorization": `Bearer ${apiToken}`
          }
        });
        const json = await res.json();
        const logs = json.data || [];

        const players = new Map();

        logs.forEach(log => {
          const msg = log;
          const join = msg.match(/Player connected: (.+?), xuid:/);
          const leave = msg.match(/Player disconnected: (.+?), xuid:/);

          if (join) players.set(join[1], true);
          if (leave) players.delete(leave[1]);
        });

        playerListDiv.innerHTML = "";

        if (players.size === 0) {
          playerListDiv.textContent = "No players online";
        } else {
          for (const name of players.keys()) {
            const div = document.createElement('div');
            div.className = 'player';
            div.textContent = name;
            playerListDiv.appendChild(div);
          }
        }
      } catch (err) {
        playerListDiv.textContent = "Failed to load player list.";
        console.error(err);
      }
    }

    fetchPlayers();
    setInterval(fetchPlayers, 5000);
  </script>
</body>
</html>
